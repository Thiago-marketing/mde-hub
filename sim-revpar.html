<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de RevPAR ‚Ä¢ MDE Hub</title>

  <!-- CSS principal do Hub -->
  <link rel="stylesheet" href="/css/app.css" />
</head>

<body class="hub-body" data-theme="dark">
  <div class="hub-layout">

    <!-- SIDEBAR -->
    <aside class="hub-sidebar" id="sidebar">
      <div class="sidebar-logo">
        <span class="sidebar-logo-text">MDE Hub</span>
      </div>

      <nav class="sidebar-nav">
        <a href="/dashboard.html" class="nav-link">Dashboard</a>
        <a href="/reservas.html" class="nav-link">Reservas</a>
        <a href="/uhs.html" class="nav-link">Unidades Habitacionais</a>
        <a href="/financeiro.html" class="nav-link">Financeiro</a>

        <div class="nav-section-title">CRM</div>
        <a href="/crm.html" class="nav-link">Painel CRM</a>
        <a href="/leads.html" class="nav-link">Leads</a>

        <div class="nav-section-title">Ferramentas</div>
        <a href="/simuladores.html" class="nav-link active">Simuladores</a>
      </nav>
    </aside>

    <!-- OVERLAY MOBILE -->
    <div class="hub-overlay" id="sidebarOverlay"></div>

    <!-- √ÅREA PRINCIPAL -->
    <div class="hub-main">

      <!-- TOPBAR -->
      <header class="hub-topbar">
        <!-- bot√£o mobile -->
        <button class="btn-icon only-mobile" id="menuToggle" aria-label="Abrir menu">
          ‚ò∞
        </button>

        <div class="topbar-left">
          <div class="user-chip">
            <span class="user-avatar" id="userInitial">U</span>
            <div class="user-info">
              <span class="user-name" id="userName">Usu√°rio de teste</span>
              <span class="user-email" id="userEmail">teste@mdesistemas.com.br</span>
            </div>
          </div>
        </div>

        <div class="topbar-right">
          <button class="btn-outline" id="themeToggle">Modo claro/escuro</button>
          <button class="btn-primary" id="logoutBtn">Sair</button>
        </div>
      </header>

      <!-- CONTE√öDO -->
      <main class="hub-content">

        <h1 class="page-title">Simulador de RevPAR</h1>
        <p class="page-subtitle">
          Calcule a receita por unidade dispon√≠vel e veja como melhorar o desempenho da sua hospedagem.
        </p>

        <section class="cards-grid">
          <!-- FORMUL√ÅRIO -->
          <article class="card">
            <h2 class="card-title">Dados do hotel</h2>

            <form id="simRevpar" style="margin-top: 16px; display: flex; flex-direction: column; gap: 16px;">
              <div class="form-grid-2">
                <div>
                  <label for="uhCount">N¬∫ de quartos (UH)</label>
                  <input type="number" id="uhCount" min="1" required placeholder="Ex: 20" />
                </div>

                <div>
                  <label for="occupancy">Ocupa√ß√£o m√©dia (%)</label>
                  <input type="number" id="occupancy" min="0" max="100" required placeholder="Ex: 65" />
                </div>
              </div>

              <div class="form-grid-2">
                <div>
                  <label for="adr">Di√°ria m√©dia (ADR) ‚Äì R$</label>
                  <input type="text" id="adr" required placeholder="Ex: 350,00" />
                </div>

                <div>
                  <label for="revparMeta">Meta de RevPAR (opcional)</label>
                  <input type="text" id="revparMeta" placeholder="Ex: 220,00" />
                </div>
              </div>

              <button type="submit" class="btn-primary" style="width: 100%; margin-top: 8px;">
                Calcular RevPAR
              </button>
            </form>
          </article>

          <!-- RESULTADO -->
          <article id="resultCard" class="card" style="display: none;">
            <h2 class="card-title">Resultado</h2>

            <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">
              <div>
                <h3 style="font-size: 15px; margin-bottom: 4px;">üìà RevPAR Atual</h3>
                <p><strong>RevPAR = </strong> <span id="revparResult"></span></p>
              </div>

              <hr style="border-color: rgba(255,255,255,0.06);" />

              <div>
                <h3 style="font-size: 15px; margin-bottom: 4px;">üìä Potencial de melhoria</h3>
                <p><strong>ADR:</strong> <span id="adrAtual"></span></p>
                <p><strong>Ocupa√ß√£o:</strong> <span id="occAtual"></span></p>
                <p><strong>Faturamento mensal estimado:</strong> <span id="fatMensal"></span></p>
              </div>

              <div id="analiseBox" style="margin-top: 8px; font-size: 14px;"></div>
            </div>

            <div style="margin-top: 16px;">
              <button id="whatsBtn" class="btn-primary" style="width: 100%; background:#22c55e; box-shadow:none;">
                Receber an√°lise no WhatsApp
              </button>
              <p style="font-size: 12px; opacity: 0.7; margin-top: 6px;">
                Voc√™ ser√° direcionado para o WhatsApp oficial da MDE (+55 11 94027-7447).
              </p>
            </div>
          </article>
        </section>

      </main>
    </div>
  </div>

  <!-- JS de layout (menu + tema) -->
  <script src="/js/hub-ui.js"></script>

  <!-- JS do simulador -->
  <script>
    function parseBRL(val) {
      if (!val) return 0;
      return parseFloat(val.replace(/\./g, "").replace(",", ".")) || 0;
    }

    function formatBRL(v) {
      return new Intl.NumberFormat("pt-BR", {
        style: "currency",
        currency: "BRL"
      }).format(v || 0);
    }

    const form = document.getElementById("simRevpar");
    const resultCard = document.getElementById("resultCard");

    const revparEl = document.getElementById("revparResult");
    const adrAtualEl = document.getElementById("adrAtual");
    const occAtualEl = document.getElementById("occAtual");
    const fatMensalEl = document.getElementById("fatMensal");
    const analiseBoxEl = document.getElementById("analiseBox");
    const whatsBtn = document.getElementById("whatsBtn");

    let lastSim = null;

    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const uh = parseInt(document.getElementById("uhCount").value);
        const occ = parseFloat(document.getElementById("occupancy").value);
        const adr = parseBRL(document.getElementById("adr").value);
        const metaRevpar = parseBRL(document.getElementById("revparMeta").value);

        if (!uh || !occ || !adr) return;

        const revpar = adr * (occ / 100);
        const dias = 30;
        const fatMensal = uh * (occ / 100) * dias * adr;

        revparEl.textContent = formatBRL(revpar);
        adrAtualEl.textContent = formatBRL(adr);
        occAtualEl.textContent = occ + "%";
        fatMensalEl.textContent = formatBRL(fatMensal);

        let analise = "";

        if (metaRevpar > 0) {
          if (revpar >= metaRevpar) {
            analise += `<p><strong>Excelente!</strong> Seu RevPAR atual j√° √© superior ou igual √† meta definida.</p>`;
          } else {
            const dif = metaRevpar - revpar;
            analise += `<p><strong>Diferen√ßa para meta:</strong> ${formatBRL(dif)}</p>`;
            analise += `<p>Para atingir essa meta, voc√™ precisar√° aumentar ADR, ocupa√ß√£o ou ambos. Um consultor MDE pode te ajudar a encontrar o melhor caminho.</p>`;
          }
        } else {
          analise += `<p>Para melhorar o RevPAR, combine aumento de reservas diretas, redu√ß√£o de depend√™ncia de OTAs e uma estrat√©gia de tarifas inteligente.</p>`;
        }

        analiseBoxEl.innerHTML = analise;
        resultCard.style.display = "block";

        lastSim = { uh, occ, adr, revpar, fatMensal, metaRevpar };
      });
    }

    if (whatsBtn) {
      whatsBtn.addEventListener("click", function () {
        if (!lastSim) return;

        const msg = `
Simula√ß√£o RevPAR - MDE

UH: ${lastSim.uh}
Ocupa√ß√£o: ${lastSim.occ}%
ADR: ${formatBRL(lastSim.adr)}

RevPAR atual: ${formatBRL(lastSim.revpar)}
Faturamento mensal estimado: ${formatBRL(lastSim.fatMensal)}
Meta RevPAR: ${formatBRL(lastSim.metaRevpar)}

Solicito an√°lise completa.
        `.trim();

        window.open(
          "https://wa.me/5511940277447?text=" + encodeURIComponent(msg),
          "_blank"
        );
      });
    }
  </script>
</body>
</html>
