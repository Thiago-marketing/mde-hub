<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Faturamento ‚Ä¢ MDE Hub</title>
  <link rel="stylesheet" href="/css/app.css" />
</head>

<body class="page">
  <!-- TOPO -->
  <header class="topbar">
    <div class="user-info">
      <span id="userInitial">U</span>
      <div>
        <p id="userName">Carregando usu√°rio...</p>
        <p id="userEmail"></p>
      </div>
    </div>

    <div class="topbar-actions">
      <a href="/simuladores.html" class="btn-secondary btn-small">
        ‚Üê Voltar para Simuladores
      </a>
      <button id="toggleThemeBtn" class="btn-secondary btn-small">
        üåì Tema
      </button>
      <button id="logoutBtn" class="btn-sair">Sair</button>
    </div>
  </header>

  <!-- MENU LATERAL -->
<aside class="sidebar">

  <h3>Opera√ß√£o</h3>
  <nav>
    <a href="/dashboard.html">Dashboard</a>
    <a href="/reservas.html">Reservas</a>
    <a href="/checkin.html">Check-in</a>
    <a href="/checkout.html">Check-out</a>
    <a href="/uhs.html">Unidades Habitacionais</a>
    <a href="/financeiro.html">Financeiro</a>
    <a href="/config.html">Configura√ß√µes</a>
  </nav>

  <h3>Simuladores</h3>
  <nav>
    <a href="/simuladores.html">Tela Principal</a>
    <a href="/sim-faturamento.html">Simulador de Faturamento</a>
    <a href="/sim-ota.html">Simulador OTA</a>
    <a href="/sim-tarifa.html">Simulador Tarifa Ideal</a>
    <a href="/sim-adr-ideal.html">Simulador ADR Ideal</a>
    <a href="/sim-revpar.html">Simulador RevPAR</a>
    <a href="/sim-checkin.html">Simulador Check-in (Tempo/Custo)</a>

    <!-- Pendentes ‚Äì ser√£o criados amanh√£ -->
    <a href="/sim-margem.html">Simulador Margem de Lucro</a>
    <a href="/sim-breakeven.html">Simulador Break-even</a>
    <a href="/sim-ocupacao-meta.html">Simulador Ocupa√ß√£o Meta</a>
    <a href="/sim-conversao.html">Simulador Convers√£o WhatsApp</a>
  </nav>

  <h3>CRM</h3>
  <nav>
    <a href="/crm-dashboard.html">Painel CRM</a>
    <a href="/leads.html">Leads</a>
    <a href="/crm-kanban.html">Kanban</a>
    <a href="/crm-atividades.html">Atividades</a>
  </nav>

  <h3>Admin</h3>
  <nav>
    <a href="/checklist-governanca.html">Checklist Governan√ßa</a>
    <a href="/auditoria.html">Auditoria</a>
    <a href="/relatorios.html">Relat√≥rios</a>
  </nav>

</aside>

  <!-- CONTE√öDO -->
  <main class="content">
    <section class="page-header">
      <h1>Simulador de Faturamento</h1>
      <p class="muted">
        Preencha os dados da sua hospedagem e veja o potencial de faturamento mensal e anual,
        al√©m do ganho estimado ao utilizar as solu√ß√µes MDE.
      </p>
    </section>

    <section class="grid grid-2">
      <!-- FORMUL√ÅRIO -->
      <form id="simForm" class="card">
        <div class="card-header">
          <h2>Dados do hotel</h2>
        </div>

        <div class="card-body form-grid">
          <div class="form-group">
            <label for="uhCount">N¬∫ de quartos (UH)</label>
            <input type="number" id="uhCount" min="1" required placeholder="Ex: 20" />
          </div>

          <div class="form-group">
            <label for="occupancy">Ocupa√ß√£o m√©dia mensal (%)</label>
            <input type="number" id="occupancy" min="0" max="100" required placeholder="Ex: 65" />
          </div>

          <div class="form-group">
            <label for="adr">Di√°ria m√©dia (ADR) ‚Äì R$</label>
            <input type="text" id="adr" required placeholder="Ex: 350,00" />
          </div>

          <div class="form-group">
            <label for="directPct">Reservas diretas (%)</label>
            <input type="number" id="directPct" min="0" max="100" required placeholder="Ex: 40" />
          </div>

          <div class="form-group">
            <label for="otaPct">Reservas via OTAs (%)</label>
            <input type="number" id="otaPct" min="0" max="100" required placeholder="Ex: 60" />
          </div>

          <div class="form-group">
            <label for="otaFee">Comiss√£o m√©dia das OTAs (%)</label>
            <input type="number" id="otaFee" min="0" max="50" required placeholder="Ex: 18" />
          </div>
        </div>

        <div class="card-footer">
          <button type="submit" class="btn btn-primary btn-full">
            Calcular faturamento
          </button>
        </div>
      </form>

      <!-- RESULTADO -->
      <section class="card" id="resultCard" style="display: none;">
        <div class="card-header">
          <h2>Resultado da simula√ß√£o</h2>
        </div>
        <div class="card-body">
          <h3>üìä Cen√°rio atual</h3>
          <p><strong>Faturamento bruto mensal:</strong> <span id="fatBruto"></span></p>
          <p><strong>Comiss√µes OTAs / m√™s:</strong> <span id="comissoes"></span></p>
          <p><strong>Faturamento l√≠quido atual:</strong> <span id="fatLiquido"></span></p>

          <hr />

          <h3>üöÄ Com MDE Sistemas</h3>
          <p><strong>Reservas diretas estimadas:</strong> <span id="novasDiretas"></span></p>
          <p><strong>Depend√™ncia de OTAs reduzida para:</strong> <span id="novasOtas"></span></p>
          <p><strong>Faturamento l√≠quido estimado:</strong> <span id="fatMde"></span></p>

          <div class="highlight-box">
            <p><strong>Ganho mensal estimado:</strong> <span id="ganhoMensal"></span></p>
            <p><strong>Ganho anual estimado:</strong> <span id="ganhoAnual"></span></p>
          </div>
        </div>

        <div class="card-footer">
          <button id="whatsBtn" class="btn btn-success btn-full">
            Receber diagn√≥stico completo no WhatsApp
          </button>
          <p class="muted small">
            Voc√™ ser√° direcionado para o WhatsApp oficial da MDE (+55 11 94027-7447)
            com o resumo desta simula√ß√£o.
          </p>
        </div>
      </section>
    </section>
  </main>

  <script>
    function parseBRLToNumber(value) {
      if (!value) return 0;
      return parseFloat(
        String(value).replace(/\./g, '').replace(',', '.')
      ) || 0;
    }

    function formatBRL(value) {
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      }).format(value || 0);
    }

    const form = document.getElementById('simForm');
    const resultCard = document.getElementById('resultCard');
    const fatBrutoEl = document.getElementById('fatBruto');
    const comissoesEl = document.getElementById('comissoes');
    const fatLiquidoEl = document.getElementById('fatLiquido');
    const novasDiretasEl = document.getElementById('novasDiretas');
    const novasOtasEl = document.getElementById('novasOtas');
    const fatMdeEl = document.getElementById('fatMde');
    const ganhoMensalEl = document.getElementById('ganhoMensal');
    const ganhoAnualEl = document.getElementById('ganhoAnual');
    const whatsBtn = document.getElementById('whatsBtn');

    let lastSimData = null;

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const uhCount = parseInt(document.getElementById('uhCount').value || '0', 10);
      const occupancy = parseFloat(document.getElementById('occupancy').value || '0');
      const adr = parseBRLToNumber(document.getElementById('adr').value);
      const directPct = parseFloat(document.getElementById('directPct').value || '0');
      const otaPct = parseFloat(document.getElementById('otaPct').value || '0');
      const otaFee = parseFloat(document.getElementById('otaFee').value || '0');

      if (!uhCount || !occupancy || !adr) {
        alert('Preencha pelo menos n¬∫ de quartos, ocupa√ß√£o e di√°ria m√©dia.');
        return;
      }

      // Garantir que diretas + OTAs somem 100
      let totalMix = directPct + otaPct;
      let adjDirect = directPct;
      let adjOta = otaPct;

      if (totalMix === 0) {
        adjDirect = 50;
        adjOta = 50;
      } else if (totalMix !== 100) {
        adjDirect = (directPct / totalMix) * 100;
        adjOta = (otaPct / totalMix) * 100;
      }

      const diasMes = 30;
      const quartosVendidosMes = uhCount * (occupancy / 100) * diasMes;
      const faturamentoBruto = quartosVendidosMes * adr;

      const fatOtaAtual = faturamentoBruto * (adjOta / 100);
      const comissoes = fatOtaAtual * (otaFee / 100);
      const fatLiquidoAtual = faturamentoBruto - comissoes;

      // Cen√°rio MDE: +15 p.p. em reservas diretas, -15 p.p. em OTAs
      let newDirect = Math.min(100, adjDirect + 15);
      let newOta = Math.max(0, adjOta - 15);

      const newTotal = newDirect + newOta;
      if (newTotal !== 100 && newTotal > 0) {
        newDirect = (newDirect / newTotal) * 100;
        newOta = (newOta / newTotal) * 100;
      }

      const fatOtaNovo = faturamentoBruto * (newOta / 100);
      const novasComissoes = fatOtaNovo * (otaFee / 100);
      const fatLiquidoMde = faturamentoBruto - novasComissoes;

      const ganhoMensal = fatLiquidoMde - fatLiquidoAtual;
      const ganhoAnual = ganhoMensal * 12;

      // Preenche na tela
      fatBrutoEl.textContent = formatBRL(faturamentoBruto);
      comissoesEl.textContent = formatBRL(comissoes);
      fatLiquidoEl.textContent = formatBRL(fatLiquidoAtual);
      novasDiretasEl.textContent = newDirect.toFixed(1) + '%';
      novasOtasEl.textContent = newOta.toFixed(1) + '%';
      fatMdeEl.textContent = formatBRL(fatLiquidoMde);
      ganhoMensalEl.textContent = formatBRL(ganhoMensal);
      ganhoAnualEl.textContent = formatBRL(ganhoAnual);

      resultCard.style.display = 'block';

      lastSimData = {
        uhCount,
        occupancy,
        adr,
        directPct: adjDirect,
        otaPct: adjOta,
        otaFee,
        faturamentoBruto,
        comissoes,
        fatLiquidoAtual,
        newDirect,
        newOta,
        fatLiquidoMde,
        ganhoMensal,
        ganhoAnual
      };
    });

    whatsBtn.addEventListener('click', function () {
      if (!lastSimData) return;

      const msg = `
Simula√ß√£o de Faturamento MDE

Quartos (UH): ${lastSimData.uhCount}
Ocupa√ß√£o m√©dia: ${lastSimData.occupancy}% 
ADR: ${formatBRL(lastSimData.adr)}

Mix atual:
- Diretas: ${lastSimData.directPct.toFixed(1)}%
- OTAs: ${lastSimData.otaPct.toFixed(1)}%
Comiss√£o OTAs: ${lastSimData.otaFee}%

Cen√°rio atual:
- Faturamento bruto: ${formatBRL(lastSimData.faturamentoBruto)}
- Comiss√µes OTAs/m√™s: ${formatBRL(lastSimData.comissoes)}
- Faturamento l√≠quido atual: ${formatBRL(lastSimData.fatLiquidoAtual)}

Com MDE (estimado):
- Diretas: ${lastSimData.newDirect.toFixed(1)}%
- OTAs: ${lastSimData.newOta.toFixed(1)}%
- Faturamento l√≠quido: ${formatBRL(lastSimData.fatLiquidoMde)}
- Ganho mensal: ${formatBRL(lastSimData.ganhoMensal)}
- Ganho anual: ${formatBRL(lastSimData.ganhoAnual)}
`.trim();

      const phone = '5511940277447'; // WhatsApp oficial MDE
      const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
      window.open(url, '_blank');
    });
  </script>

  <script src="/js/theme.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
