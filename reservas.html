<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Custo OTA ‚Ä¢ MDE Hub</title>
  <link rel="stylesheet" href="/css/app.css" />
</head>

<body class="page">

  <!-- TOPO -->
  <header class="topbar">
    <div class="user-info">
      <span id="userInitial">U</span>
      <div>
        <p id="userName">Carregando usu√°rio...</p>
        <p id="userEmail"></p>
      </div>
    </div>

    <div class="topbar-actions">
      <a href="/simuladores.html" class="btn-secondary btn-small">
        ‚Üê Voltar para Simuladores
      </a>
      <button id="toggleThemeBtn" class="btn-secondary btn-small">üåì Tema</button>
      <button id="logoutBtn" class="btn-sair">Sair</button>
    </div>
  </header>

  <!-- MENU LATERAL -->
<aside class="sidebar">

  <h3>Opera√ß√£o</h3>
  <nav>
    <a href="/dashboard.html">Dashboard</a>
    <a href="/reservas.html">Reservas</a>
    <a href="/checkin.html">Check-in</a>
    <a href="/checkout.html">Check-out</a>
    <a href="/uhs.html">Unidades Habitacionais</a>
    <a href="/financeiro.html">Financeiro</a>
    <a href="/config.html">Configura√ß√µes</a>
  </nav>

  <h3>Simuladores</h3>
  <nav>
    <a href="/simuladores.html">Tela Principal</a>
    <a href="/sim-faturamento.html">Simulador de Faturamento</a>
    <a href="/sim-ota.html">Simulador OTA</a>
    <a href="/sim-tarifa.html">Simulador Tarifa Ideal</a>
    <a href="/sim-adr-ideal.html">Simulador ADR Ideal</a>
    <a href="/sim-revpar.html">Simulador RevPAR</a>
    <a href="/sim-checkin.html">Simulador Check-in (Tempo/Custo)</a>

    <!-- Pendentes ‚Äì ser√£o criados amanh√£ -->
    <a href="/sim-margem.html">Simulador Margem de Lucro</a>
    <a href="/sim-breakeven.html">Simulador Break-even</a>
    <a href="/sim-ocupacao-meta.html">Simulador Ocupa√ß√£o Meta</a>
    <a href="/sim-conversao.html">Simulador Convers√£o WhatsApp</a>
  </nav>

  <h3>CRM</h3>
  <nav>
    <a href="/crm-dashboard.html">Painel CRM</a>
    <a href="/leads.html">Leads</a>
    <a href="/crm-kanban.html">Kanban</a>
    <a href="/crm-atividades.html">Atividades</a>
  </nav>

  <h3>Admin</h3>
  <nav>
    <a href="/checklist-governanca.html">Checklist Governan√ßa</a>
    <a href="/auditoria.html">Auditoria</a>
    <a href="/relatorios.html">Relat√≥rios</a>
  </nav>

</aside>

  <!-- CONTE√öDO -->
  <main class="content">
    <section class="page-header">
      <h1>Simulador de Custo OTA</h1>
      <p class="muted">
        Descubra quanto voc√™ paga por m√™s e por ano em comiss√µes para OTAs como Booking, Airbnb e Expedia.
      </p>
    </section>

    <section class="grid grid-2">
      <!-- FORMUL√ÅRIO -->
      <form id="simOTA" class="card">
        <div class="card-header">
          <h2>Dados da hospedagem</h2>
        </div>

        <div class="card-body form-grid">

          <div class="form-group">
            <label for="uhCount">N¬∫ de quartos (UH)</label>
            <input type="number" id="uhCount" min="1" required placeholder="Ex: 20" />
          </div>

          <div class="form-group">
            <label for="occupancy">Ocupa√ß√£o m√©dia mensal (%)</label>
            <input type="number" id="occupancy" min="0" max="100" required placeholder="Ex: 65" />
          </div>

          <div class="form-group">
            <label for="adr">Di√°ria m√©dia (ADR) ‚Äì R$</label>
            <input type="text" id="adr" required placeholder="Ex: 350,00" />
          </div>

          <div class="form-group">
            <label for="otaPct">% de reservas pelas OTAs</label>
            <input type="number" id="otaPct" min="0" max="100" required placeholder="Ex: 60" />
          </div>

          <div class="form-group">
            <label for="otaFee">Comiss√£o OTA (%)</label>
            <input type="number" id="otaFee" min="0" max="50" required placeholder="Ex: 18" />
          </div>

        </div>

        <div class="card-footer">
          <button type="submit" class="btn btn-primary btn-full">
            Calcular custo OTA
          </button>
        </div>
      </form>

      <!-- RESULTADO -->
      <section id="resultCard" class="card" style="display: none;">
        <div class="card-header">
          <h2>Resultado da simula√ß√£o</h2>
        </div>

        <div class="card-body">

          <h3>üí∏ Comiss√µes pagas √†s OTAs</h3>
          <p><strong>Comiss√£o mensal:</strong> <span id="comissaoMensal"></span></p>
          <p><strong>Comiss√£o anual:</strong> <span id="comissaoAnual"></span></p>

          <hr />

          <h3>üìä Faturamento de base</h3>
          <p><strong>Faturamento bruto mensal:</strong> <span id="fatBruto"></span></p>
          <p><strong>Faturamento via OTA:</strong> <span id="fatOta"></span></p>

          <div class="highlight-box">
            <p style="font-size: 18px;">
              üí° <strong>Reduzindo apenas 15 pontos das OTAs, voc√™ pode economizar at√©:</strong>
            </p>
            <p><strong>Por ano:</strong> <span id="economiaPotencial"></span></p>
          </div>
        </div>

        <div class="card-footer">
          <button id="whatsBtn" class="btn btn-success btn-full">
            Receber diagn√≥stico completo no WhatsApp
          </button>
          <p class="muted small">
            Voc√™ ser√° direcionado para o WhatsApp oficial da MDE (+55 11 94027-7447)
            com o resumo desta simula√ß√£o.
          </p>
        </div>
      </section>
    </section>
  </main>


<script>
  function parseBRLToNumber(value) {
    if (!value) return 0;
    return parseFloat(String(value).replace(/\./g, "").replace(",", ".")) || 0;
  }

  function formatBRL(value) {
    return new Intl.NumberFormat("pt-BR", {
      style: "currency",
      currency: "BRL",
    }).format(value || 0);
  }

  const form = document.getElementById("simOTA");
  const resultCard = document.getElementById("resultCard");

  const comissaoMensalEl = document.getElementById("comissaoMensal");
  const comissaoAnualEl = document.getElementById("comissaoAnual");
  const fatBrutoEl = document.getElementById("fatBruto");
  const fatOtaEl = document.getElementById("fatOta");
  const economiaPotencialEl = document.getElementById("economiaPotencial");

  const whatsBtn = document.getElementById("whatsBtn");

  let lastSimData = null;

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const uh = parseInt(document.getElementById("uhCount").value || "0");
    const occ = parseFloat(document.getElementById("occupancy").value || "0");
    const adr = parseBRLToNumber(document.getElementById("adr").value);
    const otaPct = parseFloat(document.getElementById("otaPct").value || "0");
    const otaFee = parseFloat(document.getElementById("otaFee").value || "0");

    if (!uh || !occ || !adr) {
      alert("Preencha todos os dados.");
      return;
    }

    const dias = 30;
    const quartosVendidos = uh * (occ / 100) * dias;

    const fatBruto = quartosVendidos * adr;
    const fatOta = fatBruto * (otaPct / 100);
    const comissaoMensal = fatOta * (otaFee / 100);
    const comissaoAnual = comissaoMensal * 12;

    const novaOta = Math.max(0, otaPct - 15);
    const fatOtaNovo = fatBruto * (novaOta / 100);
    const novasComissoes = fatOtaNovo * (otaFee / 100);
    const economiaPotencial = comissaoAnual - novasComissoes * 12;

    // Exibir
    comissaoMensalEl.textContent = formatBRL(comissaoMensal);
    comissaoAnualEl.textContent = formatBRL(comissaoAnual);
    fatBrutoEl.textContent = formatBRL(fatBruto);
    fatOtaEl.textContent = formatBRL(fatOta);
    economiaPotencialEl.textContent = formatBRL(economiaPotencial);

    resultCard.style.display = "block";

    lastSimData = {
      uh, occ, adr, otaPct, otaFee,
      fatBruto, fatOta, comissaoMensal, comissaoAnual,
      economiaPotencial
    };
  });

  // Enviar para WhatsApp
  whatsBtn.addEventListener("click", function () {
    if (!lastSimData) return;

    const msg = `
Simula√ß√£o de Custo OTA - MDE

Quartos (UH): ${lastSimData.uh}
Ocupa√ß√£o: ${lastSimData.occ}%
ADR: ${formatBRL(lastSimData.adr)}

Mix OTA: ${lastSimData.otaPct}%
Comiss√£o OTA: ${lastSimData.otaFee}%

Faturamento bruto/m√™s: ${formatBRL(lastSimData.fatBruto)}
Faturamento via OTA/m√™s: ${formatBRL(lastSimData.fatOta)}
Comiss√£o paga/m√™s: ${formatBRL(lastSimData.comissaoMensal)}
Comiss√£o paga/ano: ${formatBRL(lastSimData.comissaoAnual)}

Economia potencial reduzindo depend√™ncia das OTAs:
${formatBRL(lastSimData.economiaPotencial)} por ano.
    `.trim();

    window.open(
      "https://wa.me/5511940277447?text=" + encodeURIComponent(msg),
      "_blank"
    );
  });
</script>

<script src="/js/theme.js"></script>
<script src="/js/app.js"></script>
</body>
</html>
